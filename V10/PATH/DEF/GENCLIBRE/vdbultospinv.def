# M¢dulo : VDBUTLOSPINV.DEF                                                        
# Función: Generación automatica de rutinas C tabla VDBULTOSPINV
#                        
# Autor	 : MGM
# Revisado por: 
# Fecha  : 21-01-2008                                           
#********************************************************************************
# Histórico de cambios
# ====================
# =================================================================================
#
NOMBRE=BUPINV;
EXTRA=CANTIDAD,V10LONG;
EXTRA=CODBULTOOUT,V10CADENA,18;
EXTRA=CODCONCEAUX,V10CADENA,10;
EXTRA=CODUBIREG,V10CADENA,12;
EXTRA=RET,V10INT
EXTRA=STBUCPREPARADO,V10LONG;
EXTRA=STBPCFINALIZADO,V10LONG;
EXTRA=ESFINPICKING,V10LONG;
EXTRA=ESFINBULTO,V10LONG;
EXTRA=ESFINBULTOPINVENZONA,V10LONG;
EXTRA=ESFINBULTOPINV,V10LONG;
EXTRA=ESBULTOPINVSINSTOCK,V10LONG;
EXTRA=MIDIGEAN,V10CADENA,2;
EXTRA=CODBULTOPINV,V10CADENA,18;
EXTRA=CODBULTOPEXP,V10CADENA,18;
EXTRA=PDTECAJA,V10LONG;
EXTRA=MODOREGULARIZACION,V10LONG;
EXTRA=CANTREGULARIZAR,V10LONG;
EXTRA=OBSERV,V10CADENA,1024;
EXTRA=UNIEMB,V10LONG;

SELECT=PRIVILEGIO,SELECT VDUSER.TIENEPRIVILEGIO(:VDUSUARIO.CODOPE,NVL(:VDPRIVOPE.PRIVILEGIO,'PICKING')) TIENEPRIVILEGIO FROM DUAL;

SELECT=DATOSOPE,SELECT COUNT(DISTINCT CODOPE) NUMOPE, COUNT(*) NUMBULTOSZONA, SUM(DECODE(CODOPE,:VDUSUARIO.CODOPE,1,0)) NUMBULTOSOPE
                FROM VDBULTOZONA
                WHERE CODZONA=:VDZONAS.CODZONA;

SELECT=PDTESZONA,SELECT VDPICKINVLUCES.BULTOSPENDIENTEZONA(:VDINFODISP.IDINFOPICK, :VDBULTOCABPINV.CODMAT, :VDZONAS.CODZONA) NUMBULTOS FROM DUAL;

SELECT=ZONASPDTES,SELECT VDPICKINVLUCES.DAMEZONASPDTESDEBULTO(:VDBULTOCAB.CODBULTO) ZONASPDTES FROM DUAL;

SELECT=CANTDISPLAY,SELECT VDPICKINVLUCES.DAMECANTDISPLAY(:VDBULTOCAB.CODBULTO, :VDZONAS.CODZONA, :VDINFODISP.IDINFOPICK, :VDINFODISP.NUMDISP) CANTIDAD FROM DUAL;

SELECT=CANTDISPLAYSERVIDA,SELECT VDPICKINVLUCES.DAMECANTDISPLAYSERVIDA(:VDBULTOCAB.CODBULTO, :VDZONAS.CODZONA, :VDINFODISP.IDINFOPICK, :VDINFODISP.NUMDISP) CANTIDAD FROM DUAL;

SELECT=STOCKBULTO,SELECT VDPICKINVLUCES.DAMESTOCKBULTO(:VDBULTOCAB.CODBULTO) CANTIDAD FROM DUAL;

SELECT=TIPOCAJA, BEGIN VDPICKINVLUCES.DAMETIPOCAJABULTO(:VDBULTOCAB.CODBULTO,:VDCAJAS.TIPOCAJA); END;@

PROCEDURE=EJECUTAMOVPINV,BEGIN  
                           VDPICKINVLUCES.EJECUTAMOVPINV(:VDMOVIM.TAREA, :VDMOVIM.STATUS,
                                                           :VDBULTOCABPINV.CODBULTO,
                                                           :VDZONAS.CODZONA, :VDINFODISP.IDINFOPICK, :VDINFODISP.NUMDISP, 
                                                           :STBUCPREPARADO, :STBPCFINALIZADO,:MODOREGULARIZACION, :MIDIGEAN, :RET);
                         END;@

PROCEDURE=DAMEESTADOBULTOPINV,BEGIN 
                             VDPICKINVLUCES.DAMEESTADOBULTOPINV(:CODBULTOPINV, :VDINFODISP.IDINFOPICK, :VDINFODISP.NUMDISP, :VDBULTOCAB.CODBULTO, :ESFINBULTO, :ESFINPICKING, :ESFINBULTOPINVENZONA, :ESFINBULTOPINV, :ESBULTOPINVSINSTOCK, :RET);
                         END;@

PROCEDURE=CAMBIACAJA,BEGIN VDPICKINVLUCES.CAMBIACAJA(:VDZONAS.CODZONA,:VDBULTOCABPINV.CODBULTO, :VDBULTOCABPINV.CODMAT, :VDMOVIM.TAREA, :VDMOVIM.CODCONCE, :RET);END;@

PROCEDURE=ACTPLANIFMOV,BEGIN VDPICKINVLUCES.ACTPLANIFMOVIM(:VDBULTOCABPINV.CODBULTO, :VDZONAS.CODZONA, :VDINFODISP.IDINFOPICK, :VDINFODISP.NUMDISP, :RET);END;@ 

CURSOR=DISPAENCENDERENZONA,SELECT IDI.CODZONA, IDI.IDINFOPICK, IDI.NUMDISP, BC.CODBULTO CODBULTOEXP,  BCP.CODBULTO CODBULTOPINV, DECODE(BC.STATUS,VDST.FBUCPDTEETIQ,1,0) PDTECAJA
                FROM VDBULTOCABPINV BCP,
                     VDBULTOLINPINV BLP,
                     VDMOVIM MOV,
                     VDBULTOLIN BL,
                     VDBULTOCAB BC,
                     VDINFODISP IDI
                WHERE BCP.CODBULTO = :VDBULTOCAB.CODBULTO AND
                      BCP.CODBULTO = BLP.CODBULTO AND
                      BCP.STATUS = VDST.FBPCODS AND 
                      BLP.STATUS = VDST.FBPLASERVIR AND 
                      BLP.CODMOV = MOV.CODMOV AND
                      MOV.STATUS = VDST.FMOVPDTERECOGE AND
                      BLP.CODMOV = BL.CODMOV AND
                      BL.CODBULTO = BC.CODBULTO AND
                      BC.STATUS IN (VDST.FBUCPDTEETIQ, VDST.FBUCETIQUNI) AND
                      BL.STATUS = VDST.FBULASERVIR AND
                      IDI.CODZONA = :VDZONAS.CODZONA AND
                      IDI.IDINFOPICK = BC.IDINFOPICK AND
                      IDI.NUMDISP = BC.NUMDISP 
               ORDER BY IDI.ORDENDISP;

# DISPLAYS EN LOS QUE A SUS BULTOS ACTUALES SE HA SERVIDO ALGO EN ESA ZONA DE ESE BULTO DE PICKING INVERSO               
CURSOR=DIPSSERVIDOSENZONA, SELECT IDI.CODZONA, IDI.IDINFOPICK, IDI.NUMDISP
                      FROM VDMOVIM MOV,
                           VDBULTOLIN BL,
                           VDBULTOCAB BC,
                           VDINFODISP IDI,
                           VDBULTOLINPINV BLP,
                           VDBULTOCABPINV BCP
                      WHERE BCP.CODBULTO = :VDBULTOCABPINV.CODBULTO AND
                            BCP.CODBULTO = BLP.CODBULTO AND
                            BLP.CODMOV||'' = MOV.CODMOV AND
                            BLP.CANTSERVIDA = BLP.CANTPEDIDA AND 
                            BLP.STATUS = VDST.FBPLPROCESADA AND
                            BLP.CODMOV = BL.CODMOV AND
                            MOV.STATUS >= VDST.FMOVACTUALIZA AND                             
                            BL.CODBULTO = BC.CODBULTO AND
                            BL.STATUS = VDST.FBULSERVIDA AND
                            IDI.CODZONA = :VDZONAS.CODZONA AND
                            IDI.IDINFOPICK = BC.IDINFOPICK AND
                            IDI.NUMDISP    = BC.NUMDISP  AND
                            BC.STATUS < VDST.FBUCPREPARADO
                      ORDER BY IDI.ORDENDISP; 

CURSOR=REGULARIZARESTOSPINV,BEGIN
                              VDPICKINVLUCES.REGULARIZARESTOSPINV (:VDZONAS.CODZONA,:VDBULTOCABPINV.CODMAT, :CANTREGULARIZAR,:VDMOVIM.CODCONCE,:VDUBICA.CODUBI,:OBSERV,:VDMOVIM.CODMOV,:RET); 
                            END;@

CURSOR=BULTOPINVPDTESERVIR,SELECT COUNT(*) RET FROM VDBULTOLINPINV BLP 
                               WHERE BLP.CODBULTO = :VDBULTOCABPINV.CODBULTO AND
                                     BLP.STATUS   = VDST.FBPLASERVIR;

CURSOR=UNIEMBBULTOPINV, SELECT (STK.UNIEMB * DECODE(ART.CAJACUBETA,0,1,ART.CAJACUBETA)) UNIEMB FROM VDSTOCK STK, VDARTIC ART, VDBULTOCABPINV BPC WHERE BPC.CODBULTO=:VDBULTOCABPINV.CODBULTO AND BPC.CODMAT=STK.CODMAT AND ART.CODART = STK.CODART AND ROWNUM=1;