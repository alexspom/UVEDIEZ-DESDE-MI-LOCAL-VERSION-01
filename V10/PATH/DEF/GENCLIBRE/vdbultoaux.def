#***
# VDBULTOAUX.DEF - Generación automática del código c SOLOQUERY para Bultos
# 
# Propósito: idem.
#           
# Autor	 : FPD
# Revisado por: 
# Fecha  : 28-03-2008                                               
#********************************************************************************
# Modificaciones
#***
NOMBRE=BULTO;

EXTRA=ESTADOPED,V10LONG;
EXTRA=ACTPELIN,V10CADENA,2;
EXTRA=RET,V10LONG;
EXTRA=MIFLUJOC,V10CADENA,256
EXTRA=MIFLUJOE,V10CADENA,256
EXTRA=MIFLUJOU,V10CADENA,256
EXTRA=TIPO,V10CADENA,2
EXTRA=MIDIGITOEAN,V10CADENA,2;
EXTRA=CALCULOPESO,V10CADENA,2;
EXTRA=CALCULOVOLUMEN,V10CADENA,2;
EXTRA=LINEABULTO,V10LONG;
EXTRA=DIFERENCIA,V10LONG;
EXTRA=INICIO,V10LONG;
EXTRA=FIN,V10LONG;
EXTRA=VERIF,V10CADENA,2;
EXTRA=CANTAREGULARIZAR,V10LONG;
EXTRA=MIFLUJOPREPICK,V10CADENA,256
EXTRA=MIFLUJOPICKIV,V10CADENA,256
#ROTURAS 
EXTRA=CANTROTURA,V10DOUBLE;
EXTRA=CANTASUSTITUIR,V10DOUBLE;
EXTRA=TAREACONTE,V10CADENA,33;
EXTRA=TAREAEMBA,V10CADENA,33;
EXTRA=TAREAUNI,V10CADENA,33;
EXTRA=STATUSCONTE,V10LONG;
EXTRA=STATUSEMBA,V10LONG;
EXTRA=STATUSUNI,V10LONG;
EXTRA=STATUSNUEVOUNI,V10LONG;
EXTRA=UNIAGRUPAEMBA,V10CADENA,2;
EXTRA=UNIAGRUPAUNI,V10CADENA,2;
EXTRA=MONOFORMATO,V10CADENA,2;
EXTRA=REVISARCOMPLETO,V10CADENA,2;
EXTRA=STNUEVOMOV,V10LONG;
EXTRA=EJECMOV,V10LONG;
EXTRA=CODMATPI,V10CADENA,18;
EXTRA=CODMOVOUT,V10LONG;

PROCEDURE=FINBULTO,BEGIN VDBULTO.FINBULTO(:VDBULTOCAB.CODBULTO,:VDBULTOCAB.STATUS,:ESTADOPED,:ACTPELIN,:RET); END;@
PROCEDURE=TIPOBULTO, BEGIN
                         VDBULTO.TIPOBULTO(:VDMOVIM.TAREA,:MIFLUJOC,:MIFLUJOE,:MIFLUJOPREPICK,:MIFLUJOPICKIV,:MIFLUJOU,:TIPO);
                     END;@

CURSOR=CODBULTO, SELECT VDBULTO.SELCODBULTO(:MIDIGITOEAN,:VDBULTOCAB.CODDIV) CODBULTO FROM DUAL;

CURSOR=SECBULTOTMP, SELECT VDBULTO.SELCODBULTOTMP(:MIDIGITOEAN) SECBULTOTMP FROM DUAL;

CURSOR=SECUENCIA, SELECT VDBULTO.DAMESECUENCIA(:VDBULTOCAB.CODBULTO) SECUENCIA FROM DUAL;
  
  
PROCEDURE=CREABULTOS, BEGIN
                       VDBULTO.CREABULTOS(:VDPEDIDOCAB.CODDIV,:VDPEDIDOCAB.ANOPED,:VDPEDIDOCAB.CODPED,:VDPEDIDOCAB.SEQPED,
                                          :MIFLUJOC,:MIFLUJOE,:MIFLUJOPREPICK,:MIFLUJOPICKIV,:MIFLUJOU,:MIDIGITOEAN,:RET);
                      END;@

PROCEDURE=BORRACABECERAYLINEAS, BEGIN VDBULTO.BORRACABECERAYLINEAS(:VDBULTOCAB.CODBULTO,:RET); END;@

PROCEDURE=VOLUMETRIACAJASYCNT, BEGIN VDBULTO.VOLUMETRIACAJASYCONTENEDORES(:VDBULTOCAB.CODBULTO,:RET); END;@

PROCEDURE=RENUMERABULTOS, BEGIN VDBULTO.RENUMERABULTOS(:VDPEDIDOCAB.CODDIV,:VDPEDIDOCAB.ANOPED,:VDPEDIDOCAB.CODPED,:VDPEDIDOCAB.SEQPED,
                                                       :DIFERENCIA,:INICIO,:FIN,:RET); END;@

CURSOR=LINEABULTO, SELECT NVL(MAX(SEQLINEA),0)+1 LINEABULTO
                     FROM VDBULTOLIN
                    WHERE CODBULTO=:VDBULTOCAB.CODBULTO;
                    
CURSOR=BULTOLINORDENMOVIM, SELECT BUL.SEQLINEA,BUL.CODART,BUL.CODMOV,BUL.CODLOT,BUL.CANTPEDIDA
                             FROM VDBULTOLIN BUL,VDUBICA UBI,VDMOVIM MOV
                            WHERE BUL.CODBULTO=:VDBULTOLIN.CODBULTO AND BUL.CODMOV=MOV.CODMOV AND 
                                  MOV.CODUBIORI=UBI.CODUBI
                           ORDER BY UBI.ORDENMOVIM,BUL.CODART;

CURSOR=ULTIMOBULTO, SELECT MAX(NBULTO) ULTIMOBULTO
                      FROM VDBULTOCAB
                     WHERE CODDIV=:VDBULTOCAB.CODDIV AND ANOPED=:VDBULTOCAB.ANOPED AND
                           CODPED=:VDBULTOCAB.CODPED AND SEQPED=:VDBULTOCAB.SEQPED AND 
                           TIPOBULTO=:VDBULTOCAB.TIPOBULTO;

SELECT=CHEQUEAVOLUMETRIA, SELECT CODART  
                            FROM (SELECT CODART,SUM(CANTASERVIR) CANTASERVIR 
                                    FROM VDPEDIDOLIN 
                                   WHERE CODDIV=:VDBULTOCAB.CODDIV AND ANOPED=:VDBULTOCAB.ANOPED AND 
                                         CODPED=:VDBULTOCAB.CODPED AND SEQPED=:VDBULTOCAB.SEQPED AND 
                                         CANTASERVIR>0 AND STATUS=VDST.FPELASERVIR 
                                  GROUP BY CODART) 
                           WHERE (CODART,CANTASERVIR) NOT IN 
                                 (SELECT BUL.CODART,SUM(CANTPEDIDA) CANTIDAD 
                                    FROM VDBULTOLIN BUL,VDBULTOCAB BUC 
                                   WHERE CODDIV=:VDBULTOCAB.CODDIV AND ANOPED=:VDBULTOCAB.ANOPED AND 
                                         CODPED=:VDBULTOCAB.CODPED AND SEQPED=:VDBULTOCAB.SEQPED AND 
                                         BUL.CODBULTO=BUC.CODBULTO 
                                  GROUP BY BUL.CODART ) 
                          UNION ALL 
                          SELECT CODART  
                            FROM (SELECT BUL.CODART,SUM(CANTPEDIDA) CANTIDAD 
                                    FROM VDBULTOLIN BUL,VDBULTOCAB BUC 
                                   WHERE CODDIV=:VDBULTOCAB.CODDIV AND ANOPED=:VDBULTOCAB.ANOPED AND 
                                         CODPED=:VDBULTOCAB.CODPED AND SEQPED=:VDBULTOCAB.SEQPED AND 
                                         BUL.CODBULTO=BUC.CODBULTO 
                                  GROUP BY BUL.CODART) 
                           WHERE (CODART,CANTIDAD) NOT IN 
                                 (SELECT CODART,SUM(CANTASERVIR) CANTASERVIR 
                                    FROM VDPEDIDOLIN 
                                   WHERE CODDIV=:VDBULTOCAB.CODDIV AND ANOPED=:VDBULTOCAB.ANOPED AND 
                                         CODPED=:VDBULTOCAB.CODPED AND SEQPED=:VDBULTOCAB.SEQPED AND 
                                         CANTASERVIR>0 
                                  GROUP BY CODART );
                                  
CURSOR=DAMEULTBULTO, SELECT VDBULTO.DAMEULTBULTO(:VDBULTOCAB.CODBULTO) VERIF FROM DUAL;

PROCEDURE=ANULACANTPENDSERVIR,BEGIN VDBULTO.ANULACANTPENDSERVIR(:VDBULTOLIN.CODBULTO,:VDBULTOLIN.SEQLINEA,:CANTAREGULARIZAR,:RET); END;@

PROCEDURE=ROTURABULTO,BEGIN VDROTURA.GENERAROTURA(:VDBULTOCAB.CODBULTO, :VDBULTOLIN.SEQLINEA, :CANTROTURA, :CANTASUSTITUIR, NULL, 0,
                                                  :TAREACONTE, :TAREAEMBA, :TAREAUNI, :STATUSCONTE, :STATUSEMBA, :STATUSUNI, :STATUSNUEVOUNI,
                                                  :UNIAGRUPAEMBA, :UNIAGRUPAUNI, :MONOFORMATO, :REVISARCOMPLETO, :VDSEMAFORO.CODSEMAFORO, :VDCONCEPTO.CODCONCE,
                                                  :VDUBICA.CODUBI, :STNUEVOMOV, :RET); 
                      END;@
                      
PROCEDURE=ROTURABULTOSTK,BEGIN VDROTURA.GENERAROTURA(:VDBULTOCAB.CODBULTO, :VDBULTOLIN.SEQLINEA, :CANTROTURA, 
                               :CANTASUSTITUIR, :VDSTOCK.CODMAT, :VDSTOCK.ORDENSTK, :TAREACONTE, :TAREAEMBA, :TAREAUNI, 0, 0, 0, 0,NULL, NULL, NULL, NULL, NULL, 
                               :VDCONCEPTO.CODCONCE,:VDUBICA.CODUBI, 0, :RET); 
                      END;@   
                      
PROCEDURE=CAMBIORESERVA,BEGIN VDROTURA.CAMBIORESERVA(:VDBULTOCAB.CODBULTO, :VDBULTOLIN.SEQLINEA, :CANTROTURA, 
                               :VDSTOCK.CODMAT, :VDSTOCK.ORDENSTK, :VDCONCEPTO.CODCONCE,:VDUBICA.CODUBI,:RET, :EJECMOV,:CODMOVOUT); 
                        END;@        
                        
PROCEDURE=CAMBIORESERVAPI,BEGIN VDROTURA.CAMBIORESERVAPI(:VDBULTOCABPINV.CODBULTO, :CODMATPI, :CANTROTURA, 
                               :VDSTOCK.CODMAT, :VDSTOCK.ORDENSTK, :VDCONCEPTO.CODCONCE,:VDUBICA.CODUBI,:RET, :CODMOVOUT); 
                        END;@                                                                  
                      
       