######
# VDINTERPED.FRM - Interfase de pedidos
#
#
#
# Autor	   : Eduardo Alsina Alvarez
# Fecha    : 10-05-2008
####
# Modificaciones:
####
CAMPO=HFICHERO,AUXILIAR,OCULTO,"@L@@@@@@@@@@"
CAMPO=HFICHERO1,AUXILIAR,OCULTO,"@L@@@@@@@@@@"
CAMPO=CODDIV,AUXILIAR,OCULTO,"____"
BEGINBLOQUEFRM=VDDIVISIONES
   TABLA=DUAL
   SOLOQUERY

   SELECT=SELECT DISTINCT BUZONOUT BUZONOUT
            FROM VDDIVIS
           WHERE CODDIV LIKE :CODDIV;

   CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=BUZONOUT,AUXILIAR,OCULTO,"_256"
   CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=HFICHERO1,AUXILIAR,VIRTUAL,OCULTO
ENDBLOQUE

BEGINBLOQUEFRM=VDCABPE
  PADRE=VDDIVISIONES
  TABLA=EXPEDICIONES CABECERA
  SOLOQUERY

  PREBLOQUE=FEJECUTA(FABREFICHEROSTD(":BUZONOUT","HFICHERO"),"No puedo abrir fichero de cabeceras",
                     FABREFICHEROINTER("EXPEDICIONES","LINEA",":BUZONOUT","HFICHERO1"),"No puedo abrir fichero de lineas")

  POSTBLOQUE=FCIERRAFICHERO(":HFICHERO",":HFICHERO1")

  POSTQUERY=FEJECUTA("CSELBULTOS","No hay bultos",
                     "CSELVENDEDOR","No hay vendedor",
                     FESCRIBEFICHERO(":HFICHERO"),"")

  POSTUPDATE=FEJECUTA("CUPDACABPE","No puedo actualizar cabecera del pedido",
                      FCOMMITFICHERO(":HFICHERO",":HFICHERO1"),"No puedo hacer comit en los ficheros",
                      FCOMMIT,"")

  CAMPO=CODCOMEN,AUXILIAR,OCULTO,"@L@@@@@@@@@"
  CAMPO=ANOPED,AUXILIAR,OCULTO,"@L@@"
  CAMPO=SEQPED,AUXILIAR,OCULTO,"@L@@"

  SELECT=SELECT'E_00'||CODDIV||'J' CODDIV, CODDIV CODDIVAUX, CODPED, CODAGE, PEDIDOHOST, MENHOST, CODALB,
                TO_CHAR(TO_DATE(FECTERMIN,'J'),'DD/MM/YYYY') FECEXPIDE, DESCUENTO, RECARGO, 
                DECODE(TIPOPEDIDO,'VP','VA', 'P2','V2','PX','SX') OPA,
                ROWID MIROWID, ANOPED, SEQPED, CODCOMEN
           FROM VDPEDIDOCAB
          WHERE STATUS=11000;
VDST.FPECVERSIONES;

  CURSOR=CSELBULTOS SELECT COUNT(*) BULTOS
                      FROM VDBULTOCAB
                     WHERE CODPED = :CODPED 
                       AND CODDIV = :CODDIVAUX 
                       AND ANOPED = :ANOPED 
                       AND SEQPED = :SEQPED;

  CURSOR=CSELVENDEDOR SELECT VDCOM.DAMECOMEN(:CODCOMEN,'VENDEDOR',1) VENDEDOR, VDCOM.DAMECOMEN(:CODCOMEN,'SERIE',1) SERIE FROM DUAL;

  CURSOR=CUPDACABPE UPDATE VDPEDIDOCAB
                       SET STATUS    = VDST.FPECINTERHOST,
                           FECMODIF  = VD.FECHASYS,
                           HORAMODIF = VD.HORASYS
                     WHERE ROWID = :MIROWID;


  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=HFICHERO1,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIVAUX,AUXILIAR,OCULTO,"_4__"

ENDBLOQUE

BEGINBLOQUEFRM=VDLINPE
  PADRE=VDCABPE
  TABLA=EXPEDICIONES LINEA
  SOLOQUERY

  POSTQUERY=FESCRIBEFICHERO(":HFICHERO1")

  SELECT=SELECT SEQLINEA, CODART, CODLOT, CANTSERVIDA CANTIDAD, PRECIOUNI, DCTO,
                DECODE(:SERIE,'CEN','01','FCE','F1','PCE','P1','CEP','P1') ALMACEN
          FROM VDPEDIDOLIN LP
         WHERE CODDIV = :CODDIVAUX;

  CAMPO=CODPED,VIRTUAL,OCULTO,PREFIJO=LP
  CAMPO=CODDIVAUX,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,VIRTUAL,OCULTO,AUXILIAR
  CAMPO=ANOPED,VIRTUAL,OCULTO,PREFIJO=LP
  CAMPO=SEQPED,VIRTUAL,OCULTO,PREFIJO=LP
  CAMPO=CODALB,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=PEDIDOHOST,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=OPA,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SERIE,AUXILIAR,VIRTUAL,OCULTO

  CAMPO=HFICHERO1,AUXILIAR,VIRTUAL,OCULTO
ENDBLOQUE