# MOdulo   : VDASOCIAPICKINGTERM2.PAN
# Función  : Formulario de asociación de bultos a terminal por radio
#
# Creación : 12-05-2008
# Autor    : JMM
###########################################
# HistOrico de cambios:
# 
  ASOCIAR BULTOS A TERMINAL
  TERMINAL: ___________
  OPERARIO: ________________
  BULTOS ASOCIADOS: #L#######
  LINEAS PICKING:   #L#######

  BULTO: ___________________ 
  ESTADO: ___________________
 
 1. ASIGNAR 
 2. ASIGNAR Y PREPARACION. 
 3. DESASIGNAR
 4. VER BULTOS
 5. CANCELAR  
 
 ELIGE _
|

PREQUERY=FEJECUTA("+CLIMPIA","")

POSTQUERY=FEJECUTA( FSWITCHCADENA(":OPCION",
                                 "1",FEJECUTA("CASIGNABULTO","ERROR \n EN CASIGNABULTO 1",FCOMMIT,"ERROR\n HACIENDO COMMIT 1",FPOSICIONABLOQUE("VDASOCIAPICKINGTERM1.PAN"),"ERROR \nCARGANDO BLOQUE VDASOCIAPICKINGTERM1.PAN"), 
                                 "2",FEJECUTA("CASIGNABULTO","ERROR \n EN CASIGNABULTO 2",FCOMMIT,"ERROR\n HACIENDO COMMIT 2",FCARGAFORM("VDPICKUNICARRO.FRM"),"ERROR \nCARGANDO BLOQUE VDPICKUNICARRO.PAN"), 
                                 "3",FEJECUTA("CDESASIGNABULTO","ERROR \n EN CDESASIGNABULTO",FCOMMIT,"ERROR\n HACIENDO COMMIT 3",FPOSICIONABLOQUE("VDASOCIAPICKINGTERM1.PAN"),"ERROR \nCARGANDO BLOQUE VDASOCIAPICKINGTERM1.PAN"), 
                                 "4",FPOSICIONABLOQUE("VDASOCIAPICKINGTERM3.PAN"), 
                                 "5",FPOSICIONABLOQUE("VDASOCIAPICKINGTERM1.PAN"),
                                 "",FPOSICIONABLOQUE("0")),"ERROR EN SWITCH")


CAMPO=CODRECURSO,NOENTER,VIRTUAL
CAMPO=CODOPE,NOENTER,VIRTUAL
CAMPO=NBULTOS,VIRTUAL,NOENTER
CAMPO=NLINEAS,VIRTUAL,NOENTER
CAMPO=CODBULTO,VIRTUAL,NOENTER
CAMPO=ESTADO,VIRTUAL,NOENTER
CAMPO=OPCION

CURSOR=CLIMPIA SELECT '1' OPCION FROM DUAL;

CURSOR=CASIGNABULTO UPDATE VDMOVIM SET CODRECURSO=:CODRECURSO,STATUS=#STMOVASIGNADO 
                     WHERE CODMOV IN (SELECT MOV.CODMOV 
                                        FROM VDMOVIM MOV, VDBULTOLIN BUL
                                       WHERE BUL.CODBULTO=:CODBULTO AND BUL.CODMOV=MOV.CODMOV AND MOV.STATUS=#STMOVPDTERECOGE);
                                             
CURSOR=CDESASIGNABULTO UPDATE VDMOVIM SET CODRECURSO=NULL, STATUS=#STMOVPDTERECOGE
                        WHERE CODMOV IN (SELECT MOV.CODMOV 
                                           FROM VDMOVIM MOV,VDBULTOLIN BUL 
                                          WHERE BUL.CODBULTO=:CODBULTO AND BUL.CODMOV=MOV.CODMOV AND 
                                                MOV.STATUS=#STMOVASIGNADO AND MOV.CODRECURSO=:CODRECURSO);                                             