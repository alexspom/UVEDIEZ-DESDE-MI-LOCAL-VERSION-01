Mantenimiento de lineas de devolucion
NumCaja Articulo     Designación           Cant.     Causa      Precinto   A Observ                Ultima modificación
@L@@@   _20_________ _40__________________ @L@@@@@@@ __________ __________ _ _255_________________ _32______________ ¿D-MM-Y.YY ________
|


TABLA=VDDEVOLLIN
ORDERBY=NUMCAJA,CODART;

NOINSERT,PROTECT("SUPERVISOR")
NOUPDATE,PROTECT("SUPERVISOR")
REGPAG=10

PREUPDATE=FEJECUTA("CCOMPPRECINTO","NO SE PUEDE ACTUALIZAR LA LINEA\n\n\nEL PRECINTO ESTA DESTRUIDO O INVENTARIADO",
                   "CSELDVCFINALIZADA","LA DEVOLUCION NO PUEDE ESTAR FINALIZADA\n\nPARA MODIFICAR ESTE CAMPO")


CAMPO=NUMCAJA,TITULO("Caja"),WLONX=16
CAMPO=SEQDEVOL,VIRTUAL,OCULTO
CAMPO=CODART,UPPER,NOUPDATE,POSTCHANGE=FDESIGNACION("CSELDESART","No existe artículo"),TITULO("Código")
CAMPO=DESART,AUXILIAR,NOENTER,TITULO("Designación"),TITULO("Designación")
CAMPO=CODLOT,UPPER,NOUPDATE,POSTCHANGE=FDESIGNACION("CSELCODLOT","No existe lote"),TITULO("Lote"),OCULTO,"_20"
CAMPO=CADUCI,AUXILIAR,NOENTER,TITULO("Caducidad"),OCULTO,"_10"
CAMPO=STLOTEAB,NOENTER,TOOLTIP("El estado del lote para determinar si es abonable o no\n\n0 NO ABONABLE. Al no tener definidos criterios;\n\n1 NO ABONABLE. No ha caducado y caduca mas allá de X meses;\n\n2 ABONABLE. Caducado hace menos de Y meses o no caducado, y caduca en menos de X meses;\n\n3 NO ABONABLE. Caducado hace mas de Y meses"),OCULTO,"_"
CAMPO=STLOTEAPTO,NOENTER,TOOLTIP("El estado del lote para determinar si es apto o no\n\n0 NO APTO, al no definirse criterios\n\n1 NO APTO. No ha caducado pero caduca en menos de Z meses\n\n2 APTO.No ha caducado y caduca mas alla de Z meses\n\n3 NO APTO. Caducado"),OCULTO,"_"

CAMPO=CANTIDAD,NOUPDATE,TITULO("Cantidad")
CAMPO=STATUS,COMBOX("CSTATUS"),POSTCHANGE=FEJECUTA("+CDAMESTATUS",""),TITULO("Estado"),WLONX=20,OCULTO,"@L@@"
CAMPO=DESSTATUS,AUXILIAR,NOENTER,WLONX=30,OCULTO,"_30"

CAMPO=CODCAUSA,COMBOX("CSELCAUSA"),TITULO("Causa")
CAMPO=CODPRECINTO,COMBOX("CSELPREC"),TITULO("Precinto")
CAMPO=TIPOABC
CAMPO=ABONABLE,POSTCHANGE=FVERIFICA("SN ","Debe introducir S(i) o N(o)"),TITULO("A"),OCULTO,"_"
CAMPO=OBSERV,TITULO("Observaciones")
CAMPO=CODOPEINS,NOENTER,TITULO("Ultima modificación")
CAMPO=FECINS,NOENTER
CAMPO=HORAINS,NOENTER
CAMPO=CODOPENOAPTO,OCULTO,"_32______________"
CAMPO=FECNOAPTO,OCULTO,"¿D-MM-Y.YY"
CAMPO=HORANOAPTO,OCULTO,"________"
CAMPO=CODOPEINVEN,OCULTO,"_32______________"
CAMPO=FECINVEN,OCULTO,"¿D-MM-Y.YY"
CAMPO=HORAINVEN,OCULTO,"________"
CAMPO=CODOPEDESTRUYE,OCULTO,"_32______________"
CAMPO=FECDESTRUYE,OCULTO,"¿D-MM-Y.YY"
CAMPO=HORADESTRUYE,OCULTO,"________"
CAMPO=CODOPESALIDAEXT,OCULTO,"_32______________"
CAMPO=FECSALIDAEXT,OCULTO,"¿D-MM-Y.YY"
CAMPO=HORASALIDAEXT,OCULTO,"________"
CAMPO=CODOPEMODIF,OCULTO,"_32______________"
CAMPO=FECMODIF,OCULTO,"¿D-MM-Y.YY"
CAMPO=HORAMODIF,OCULTO,"________"
CAMPO=STATUSDVC,AUXILIAR,VIRTUAL,OCULTO
CAMPO=CODPRECINTOAUX,NOUPDATE,AUXILIAR,OCULTO,"_9_"
CAMPO=TIPOPRECINTOAUX,NOUPDATE,AUXILIAR,OCULTO,"_25_"
CAMPO=MENSAJE,NOUPDATE,AUXILIAR,OCULTO,"_600_"

CURSOR=CSTATUS SELECT STATUS,DESSTATUS FROM VDSTATUS WHERE TIPOSTATUS='DVL' ORDER BY STATUS;

CURSOR=CDAMESTATUS SELECT DESSTATUS FROM VDSTATUS WHERE STATUS=:STATUS AND TIPOSTATUS='DVL';

CURSOR=CSELCAUSA SELECT CODCAUSA,DESCAUSA,DECODE(INTERNO,'S','INTERNO','N','EXTERIOR') INTERNO FROM VDDEVOLCAUSA ORDER BY INTERNO;


CURSOR=CSELOPEINS SELECT VDUSER.GETUSER CODOPEINS,VD.FECHASYS FECINS,VD.HORASYS HORAINS
                    FROM DUAL;
                    
CURSOR=CSELDESART BEGIN
                    SELECT DESART INTO :DESART FROM VDARTIC WHERE CODART=:CODART;
                    EXCEPTION WHEN NO_DATA_FOUND THEN
                      SELECT CODART,DESART INTO :CODART,:DESART FROM VDARTIC WHERE CODEAN LIKE '_'||:CODART;
                  END;@

CURSOR=CSELCODLOT SELECT CADUCI FROM VDLOTES WHERE CODART=:CODART AND CODLOT=:CODLOT;


CURSOR=CDESTRUYELIN SELECT VDDEVOL.DAMEPRECINTO(:CODART) CODPRECINTO,VDUSER.GETUSER CODOPEDESTRUYE,VD.FECHASYS FECDESTRUYE,VD.HORASYS HORADESTRUYE,
                                  VDUSER.GETUSER CODOPEMODIF,VD.FECHASYS FECMODIF,VD.HORASYS HORAMODIF
                            FROM DUAL;
                    
CURSOR=CPDTEDESTRUIR SELECT :CODPRECINTO FROM VDDEVOLCAB WHERE SEQDEVOL=:SEQDEVOL AND STATUS<=VDST.FDVCVALIDADA;                    

CURSOR=CLINEADESTRUIBLE SELECT :CODPRECINTO FROM DUAL WHERE :CODPRECINTO IS NULL AND :ABONABLE='N' AND :HORADESTRUYE IS NULL; 

CURSOR=CDUMMY SELECT TO_NUMBER(:SEQDEVOL) SEQDEVOL FROM DUAL WHERE 1=1;

CURSOR=CHAYST SELECT :SEQDEVOL FROM VDDEVOLCAB WHERE SEQDEVOL=:SEQDEVOL AND CODALBAST IS NOT NULL;

CURSOR=CSELPREC SELECT CODPRECINTO,TIPOPRECINTO FROM VDPRECINTO WHERE STATUS=VDVST.FPRCABIERTO
                UNION
                SELECT '' CODPRECINTO,'' TIPOPRECINTO FROM DUAL;

CURSOR=CCOMPPRECINTO SELECT :SEQDEVOL FROM DUAL
                      WHERE :CODPRECINTO IS NULL OR
                            :CODPRECINTO IN (SELECT CODPRECINTO FROM VDPRECINTO WHERE STATUS<VDVST.FPRCDESTRUIDO);

CURSOR=CBORRALINEA SELECT :SEQDEVOL FROM DUAL
                    WHERE :STATUSDVC IN (VDVST.FDVCENCURSO,VDVST.FDVCESCANEADA) AND :STATUS!=VDVST.FDVLAPTO;

CURSOR=CDELDVL DELETE VDDEVOLLIN WHERE ROWID=:MIROWID;

CURSOR=CLINAPREC SELECT :SEQDEVOL FROM DUAL
                  WHERE :STATUSDVC>VDVST.FDVCENCURSO AND :STATUS=VDVST.FDVLDEVCLIENTE;

CURSOR=CSELPRECINTO SELECT CODPRECINTO CODPRECINTOAUX,TIPOPRECINTO TIPOPRECINTOAUX
                      FROM VDPRECINTO 
                     WHERE STATUS = VDVST.FPRCABIERTO AND
                           VDDEVOL.COMPATIBLEPREC(TIPOPRECINTO, VDDEVOL.DAMETIPOPRECINTOART(:CODART,:STATUS))>0;

CURSOR=CUPDDVL UPDATE VDDEVOLLIN SET CODPRECINTO=:CODPRECINTOAUX, STATUS=VDVST.FDVLNOAPTO,
                                     CODOPEMODIF = VDUSER.GETUSER, FECMODIF = VD.FECHASYS, HORAMODIF = VD.HORASYS
                WHERE ROWID=:MIROWID;

CURSOR=CIMPREPL SELECT :SEQDEVOL FROM DUAL
                 WHERE :STATUS IN  (VDVST.FDVLDEVCLIENTE,VDVST.FDVLDEVEXT) AND :NUMCAJA>0;

CURSOR=CSELMENSAJEPREC SELECT '&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDEPOSITE LINEA EN\n\n&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPRECINTO <FONT class="resmens1"> ' || :CODPRECINTOAUX || ' </FONT>\n\nDE TIPO <FONT class="resmens2" > ''' || :TIPOPRECINTOAUX || ''' </FONT>&nbsp&nbsp&nbsp&nbsp\n\n&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<FONT class="resmens3" >EN USO</FONT>\n\n' MENSAJE
                         FROM DUAL;


CURSOR=CSELABONABLE SELECT :SEQDEVOL FROM DUAL
                     WHERE :ABONABLE IN ('S','N',' ');

CURSOR=CSELDVCFINALIZADA SELECT :SEQDEVOL FROM DUAL
                          WHERE :STATUSDVC<VDVST.FDVCFINALIZADA;

TECLA=F9,FEJECUTA("CCOMPPRECINTO","NO SE PUEDE BORRAR LA LINEA\n\n\nEL PRECINTO ESTA DESTRUIDO O INVENTARIADO",
                  "CBORRALINEA","NO SE PUEDE BORRAR LA LINEA\n\n\nLA DEVOLUCION DEBE ESTAR EN CURSO O ESCANEADA\nY LA LINEA NO PUEDE TENER ESTADO 'APTO BLOQUEADA'",
                  "+CDELDVL","",
                  "+CDELLABELING","",
                  +FCOMMIT,"",
                  +FPULSATECLAS("F3","F2"),"")

TECLA=1001,FEJECUTA(FIF("CHAYST",
                        FIMPRIME("ETIQ","VDDEVOLST.GEN;VDDEVOL.VSQ;CSELDEVOLCAJ","SEQDEVOL=:SEQDEVOL;NUMCAJA=:NUMCAJA;CODART=:CODART;STATUS=:STATUS",""),
                        FIMPRIME("ETIQ","VDDEVOLCLI.GEN;VDDEVOL.VSQ;CSELDEVOLCAJ","SEQDEVOL=:SEQDEVOL;NUMCAJA=:NUMCAJA;CODART=:CODART;STATUS=:STATUS","")),"ERROR IMPRIMIENDO LA CAJA")

TECLA=1002,FEJECUTA("CIMPREPL","NO SE PUEDE IMPRIMIR PACKING LIST\n\n SI LA LINEA NO ES DE CAJA CLIENTE O CAJA SINIESTRO",
                    FIMPRIME("INFORME","PACKINGLISTCC.RPT","PSEQDEVOL=:SEQDEVOL;PNUMCAJA=:NUMCAJA","",""),"ERROR IMPRIMIENDO PACKING LIST")

TECLA=1003,FEJECUTA("CLINAPREC","NO SE PUEDE ENVIAR LINEA A PRECINTO\n\n\nLA DEVOLUCION DEBE ESTAR EN ESTADO MAYOR QUE EN CURSO\nY LA LINEA EN ESTADO 'CAJA CLIENTE'",
                    "CSELPRECINTO","NO SE PUEDE OBTENER\n PRECINTO COMPATIBLE",
                    "+CUPDDVL","",
                    "CSELMENSAJEPREC","ERROR PRESENTANDO MENSAJE",
                    FEJECUTA(FHTMLALERT("VERTIS.CAJADEVOLNUEVA.msjalert.html"),"",
                             %FFAILURE,":MENSAJE"),"",
                    +FCOMMIT,"",
                    +FPULSATECLAS("F3","F2"),"")