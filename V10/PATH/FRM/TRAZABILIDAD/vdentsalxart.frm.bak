# Módulo   : VDENTSALXART.FRM
# Función  : Trazabilidad por artículo
#
# Creación : 14-08-2008
# Autor    : MGM
###########################################
BEGINBLOQUE=VDARTICTRZ.PAN
  PREREGISTRO=PRESEHIJO
  NOINSERT
  NODELETE
  NOUPDATE
  NOCOMMIT
  POSY=1
  WLONX=1030
 CAMPO=TOTALENTRADAS,AUXILIAR,OCULTO,"###############"
 CAMPO=TOTALSALIDAS,AUXILIAR,OCULTO,"###############"
 CAMPO=TOTALSALDO,AUXILIAR,OCULTO,"###############"
 CAMPO=SALDOPARCIAL,AUXILIAR,OCULTO,"###############"
 CAMPO=STOCKACTUAL,AUXILIAR,OCULTO,"###############"
 
 TECLA=SF8,FEJECUTA(FIMPRIME("INFORME","VDTRAZABILIDAD.rpt","CODART=:CODART;CODLOT='';CODCONCE='';FECDESDE='01-01-01';FECHASTA='31-12-50'",""),":V10ERROR")
 TECLA=SF9,FEJECUTA(FIMPRIME("INFORME","VDTRAZABILIDAD.rpt","CODART=:CODART;CODLOT='';CODCONCE='PEDEXPED';FECDESDE='01-01-01';FECHASTA='31-12-50'",""),":V10ERROR")

 AYUDA=TRAZABILIDAD
ENDBLOQUE     

BEGINBLOQUE=VDENTSALXART.PAN
  PADRE=VDARTICTRZ.PAN
  PREREGISTRO=PRESEHIJO
  PREQUERY=QUERYHIJO
#  WGRAFICA=TRAZA,600,33,400,210,0

  POSY=19
  REGPAG=19
  WPOSY=285
  NOINSERT
  NODELETE
  NOUPDATE
  NOCOMMIT
  PREQUERY=FEJECUTA("+CINICIALIZA","",+QUERYHIJO,"",
                    "+CCALCSTOCK","")

  POSTQUERY=FEJECUTA("+CACUMULA","ERROR ACUMULANDO",
                     "+CDAMESALDOPARCIAL","ERROR CALCULANDO EL SALDO PARCIAL")
  
  CURSOR=CINICIALIZA SELECT 0 TOTALENTRADAS,0 TOTALSALIDAS,0 TOTALSALDO,0 SALDOPARCIAL FROM DUAL;
  CURSOR=CCALCSTOCK  SELECT NVL(SUM(CANTIDAD),0) STOCKACTUAL FROM VDSTOCK WHERE CODART=:CODART ; 
  CURSOR=CACUMULA Select :TOTALENTRADAS + DECODE(:TRAZASTOCK,'N',0,DECODE(:TIPOOPE,'E',:CANTIDAD,0)) TOTALENTRADAS,
                         :TOTALSALIDAS  + DECODE(:TRAZASTOCK,'N',0,DECODE(:TIPOOPE,'S',:CANTIDAD,0)) TOTALSALIDAS ,
                         :SALDOPARCIAL  + DECODE(:TRAZASTOCK,'N',0,:CANTIDAD) SALDOPARCIAL,
                         :TOTALSALDO  + DECODE(:TRAZASTOCK,'N',0,:CANTIDAD)   TOTALSALDO                          
                  FROM DUAL;
 CURSOR=CDAMESALDOPARCIAL Select :SALDOPARCIAL SALDOPARCIALAUX FROM DUAL;
 
 TECLA=SF8,FEJECUTA(FIMPRIME("INFORME","VDTRAZABILIDAD.rpt","CODART=:CODART;CODLOT='';CODCONCE='';FECDESDE='01-01-01';FECHASTA='31-12-50'",""),":V10ERROR")
 TECLA=SF9,FEJECUTA(FIMPRIME("INFORME","VDTRAZABILIDAD.rpt","CODART=:CODART;CODLOT='';CODCONCE='''PEDEXPED';FECDESDE='01-01-01';FECHASTA='31-12-50'",""),":V10ERROR")
 

CAMPO=CODART,VIRTUAL,OCULTO
CAMPO=TOTALENTRADAS,AUXILIAR,VIRTUAL,OCULTO
CAMPO=TOTALSALIDAS,AUXILIAR,VIRTUAL,OCULTO
CAMPO=TOTALSALDO,AUXILIAR,VIRTUAL,OCULTO
CAMPO=SALDOPARCIAL,AUXILIAR,VIRTUAL,OCULTO
CAMPO=STOCKACTUAL,AUXILIAR,VIRTUAL,OCULTO
ENDBLOQUE

BEGINBLOQUE=VDENTSALXARTXPED.PAN
  PADRE=VDENTSALXART.PAN
  PREQUERY=QUERYHIJO
  REGPAG=15
  POSX=1
  POSY=42
  WPOSY=600

ENDBLOQUE

BEGINBLOQUE=VDENTSALXARTTOT.PAN
  PADRE=VDENTSALXART.PAN
  WPOSY=200
  WPOSX=50
  NOENTER
  POSY=15
#REGPAG=1
  REGPAG=2
  NOINSERT
  NODELETE
  NOUPDATE
  WMARCOFRAME
ENDBLOQUE

