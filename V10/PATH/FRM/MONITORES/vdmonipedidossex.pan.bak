# Módulo   : VDMONIPEDIDOSSEX.PAN
# Función  : Monitor de pedidos pendientes. Series de expedicion
#
# Creación : 08-08-2008
# Autor    : JMM
###########################################
# Histórico de cambios:
#
SERIES DE EXPEDICION
                                                             ÏÄÄ PEDIDOS ÄÄË   ÏÄ Bul. Unid.ÄË ÏÄBul. Emba.ÄË  ÏÄBul.Cont. ÄË
Codigo                       Agencia   Estado                EspStk Prep Term   Prepar Termin   Prepar Termin   Prepar Termin Sel.
@L@@@ @L@@@ ________________ _40______ @L@@@ _30__________  @L@@  @L@@ @L@@   @L@@@@ @L@@@@   @L@@@@ @L@@@@   @L@@@@ @L@@@@  _
|

TABLA=SEX
SOLOQUERY
WFRAME(405,-3,142,0,"Pedidos","")
WFRAME(547,-3,85,0,"Bul. Unid.","")
WFRAME(629,-3,85,0,"Bul. Emba.","")
WFRAME(715,-3,81,0,"Bul. Cont.","")

SELECT=SELECT DISTINCT SEX.CODSERIEPREP,SEX.CODSERIEEXP, SEX.CODAGE, SEX.STATUS, SEX.DESSERIE
         FROM VDSERIEEXP SEX, VDPEDIDOCAB PEC
        WHERE SEX.STATUS < VDST.FSEXIMPRESA AND
              PEC.CODSERIEEXP = SEX.CODSERIEEXP AND
              VD.CONTIENECAD(:RANAGE,SEX.CODAGE) = 1 AND
              VD.CONTIENECAD(:RANDIV,PEC.CODDIV) = 1 AND
              VD.CONTIENECAD(:RANALM,ARE.CODALM) = 1;
ORDERBY=SEX.CODSERIEEXP DESC;

PREQUERY=FEJECUTA("+CLIMPIARANGO","")

POSTQUERY=FEJECUTA("CCOUNTPEDESPSTK","ERROR CALCULANDO PEDIDOS ESPERANDO STOCK",
                   "CCOUNTPEDENCURSO","ERROR CALCULANDO PEDIDOS EN CURSO",
                   "CCOUNTPEDTERMIN","ERROR CALCULANDO PEDIDOS TERMINADOS",
                   "CCOUNTBULENCURSO","ERROR CALCULANDO BULTOS EN CURSO",
                   "CCOUNTBULTERMIN","ERROR CALCULANDO BULTOS TERMINADOS")

CAMPO=CODSERIEPREP,TITULO("S. Prep"),WLONX=20
CAMPO=CODSERIEEXP,NOUPDATE,TOOLTIP("COdigo de la serie de expedicion"),TITULO("Serie"),WLONX=10
CAMPO=DESSERIE,NOENTER
CAMPO=CODAGE,TITULO("Agencia")
CAMPO=DESAGE,OCULTO,"_40_",AUXILIAR,NOENTER,TOOLTIP("Descripcion de la agencia de transporte")
CAMPO=STATUS,NOUPDATE,TOOLTIP("Estado de la serie de expedicion"),POSTCHANGE=FDESIGNACION("+CSELDESSTATUS",""),TITULO("Estado")
CAMPO=DESSTATUS,AUXILIAR,NOENTER,TOOLTIP("Descripcion del estado")
CAMPO=PEDESPSTK,AUXILIAR,NOENTER,TOOLTIP("Pedidos de la serie que estan esperando stock"),TITULO("EspStk"),WLONX=20
CAMPO=PEDENCURSO,AUXILIAR,NOENTER,TOOLTIP("Pedidos de la serie que estan preparandose"),TITULO("Prep"),WLONX=20
CAMPO=PEDTERMIN,AUXILIAR,NOENTER,TOOLTIP("Pedidos de la serie que estan terminados"),TITULO("Term"),WLONX=20
CAMPO=BULUNIENCURSO,AUXILIAR,NOENTER,TOOLTIP("Bultos de unidades de la serie que estan preparandose"),TITULO("Prep")
CAMPO=BULUNITERMIN,AUXILIAR,NOENTER,TOOLTIP("Bultos de unidades de la serie que estan terminados"),TITULO("Term")
CAMPO=BULEMBAENCURSO,AUXILIAR,NOENTER,TOOLTIP("Bultos de caja completa de la serie que estan preparandose"),TITULO("Prep")
CAMPO=BULEMBATERMIN,AUXILIAR,NOENTER,TOOLTIP("Bultos de caja completa de la serie que estan terminados"),TITULO("Term")
CAMPO=BULCNTENCURSO,AUXILIAR,NOENTER,TOOLTIP("Bultos de contenedor completo de la serie que estan preparandose"),TITULO("Prep")
CAMPO=BULCNTTERMIN,AUXILIAR,NOENTER,TOOLTIP("Bultos de contenedor completo de la serie que estan terminados"),TITULO("Term")
CAMPO=SEL,AUXILIAR,UPPER,TOOLTIP(":RANSERIEEXP"),POSTCHANGE=FDESIGNACION("CCHECKVALUES","Debe introducir S(i) o N(o)",
                                                                         FIF("CSELINCLUDE",FIF("-CCHECKRANSERIEEXP","CAPENDSERIEEXP"),
                                                                                           FIF("CCHECKRANSERIEEXP","CELIMINASERIEEXP")),
                                                                         "ERROR MODIFICANDO VARIABLE RANSERIEEXP"),TITULO("Sel"),WLONX=10

CURSOR=CLIMPIARANGO SELECT NULL RANSERIEEXP FROM DUAL;

CURSOR=CSELDESAGE SELECT DESAGE FROM VDAGENCIA WHERE CODAGE = :CODAGE;

CURSOR=CSELDESSTATUS SELECT DESSTATUS FROM VDSTATUS WHERE STATUS = :STATUS AND TIPOSTATUS = 'SEX';

CURSOR=CCHECKVALUES SELECT :SEL FROM DUAL WHERE :SEL IS NULL OR :SEL IN ('S','N');

CURSOR=CSELINCLUDE SELECT :SEL FROM DUAL WHERE :SEL = 'S';

CURSOR=CCHECKRANSERIEEXP SELECT :CODSERIEEXP FROM DUAL WHERE VD.CONTIENENUM(:RANSERIEEXP,:CODSERIEEXP) = 1 AND :RANSERIEEXP IS NOT NULL;

CURSOR=CAPENDSERIEEXP SELECT DECODE(:RANSERIEEXP,NULL,TO_CHAR(:CODSERIEEXP),:RANSERIEEXP||','||TO_CHAR(:CODSERIEEXP)) RANSERIEEXP FROM DUAL;

CURSOR=CELIMINASERIEEXP SELECT VD.ELIMINAPIEZA(:RANSERIEEXP,:CODSERIEEXP) RANSERIEEXP FROM DUAL;

CURSOR=CCOUNTPEDESPSTK SELECT COUNT(*) PEDESPSTK FROM VDPEDIDOCAB WHERE CODSERIEEXP = :CODSERIEEXP AND STATUS+0 = VDST.FPECPDTESTOCK;

CURSOR=CCOUNTPEDENCURSO SELECT COUNT(*) PEDENCURSO FROM VDPEDIDOCAB WHERE CODSERIEEXP = :CODSERIEEXP AND STATUS+0 BETWEEN VDST.FPECPDTESTOCK+1 AND VDST.FPECPREPARANDO;

CURSOR=CCOUNTPEDTERMIN SELECT COUNT(*) PEDTERMIN FROM VDPEDIDOCAB WHERE CODSERIEEXP = :CODSERIEEXP AND STATUS+0 > VDST.FPECPREPARANDO;

CURSOR=CCOUNTBULENCURSO SELECT SUM(DECODE(TIPOBULTO,'U',1,0)) BULUNIENCURSO,
                               SUM(DECODE(TIPOBULTO,'E',1,0)) BULEMBAENCURSO,
                               SUM(DECODE(TIPOBULTO,'C',1,0)) BULCNTENCURSO
                          FROM VDBULTOCAB BUC, VDPEDIDOCAB PEC
                         WHERE PEC.CODSERIEEXP = :CODSERIEEXP AND
                               PEC.CODPED = BUC.CODPED AND PEC.CODDIV = BUC.CODDIV AND
                               PEC.ANOPED = BUC.ANOPED AND PEC.SEQPED = BUC.SEQPED AND
                               BUC.STATUS+0 < VDST.FBUCAEXPED;

CURSOR=CCOUNTBULTERMIN SELECT SUM(DECODE(TIPOBULTO,'U',1,0)) BULUNITERMIN,
                              SUM(DECODE(TIPOBULTO,'E',1,0)) BULEMBATERMIN,
                              SUM(DECODE(TIPOBULTO,'C',1,0)) BULCNTTERMIN
                         FROM VDBULTOCAB BUC, VDPEDIDOCAB PEC
                        WHERE PEC.CODSERIEEXP = :CODSERIEEXP AND
                              PEC.CODPED = BUC.CODPED AND PEC.CODDIV = BUC.CODDIV AND
                              PEC.ANOPED = BUC.ANOPED AND PEC.SEQPED = BUC.SEQPED AND
                              BUC.STATUS+0 >= VDST.FBUCAEXPED;

