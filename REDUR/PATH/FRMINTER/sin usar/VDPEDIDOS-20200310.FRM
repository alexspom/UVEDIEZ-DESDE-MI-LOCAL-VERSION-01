CAMPO=HFICHERO,AUXILIAR,OCULTO,"@L@@@@@@@@@@"
CAMPO=CODDIV,AUXILIAR,OCULTO,"____"

BEGINBLOQUEFRM=PEDDIV
   TABLA=DUAL
   SOLOQUERY 

   SELECT=SELECT DISTINCT BUZONOUT BUZONOUT,'PEDIDOS_'||TO_CHAR(SYSDATE,'DDMMYYYYHH24MISS') || '.TXT' NOMBREFICH
           FROM VDDIVIS
           WHERE CODDIV ='BEL';

   CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=BUZONOUT,AUXILIAR,OCULTO,"_256"
   CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=NOMBREFICH,AUXILIAR,OCULTO,"_256"
ENDBLOQUE

BEGINBLOQUEFRM=CABECERAS
  PADRE=PEDDIV
  TABLA=EXPED CAB
  SOLOQUERY

  PREBLOQUE=FEJECUTA(FDEBUG,"", FABREFICHERONOMBRE(":BUZONOUT","HFICHERO",":NOMBREFICH"), "")

  POSTBLOQUE=FEJECUTA(FCIERRAFICHERO(":HFICHERO"),"",
                      FCOMMIT,"")

  POSTQUERY=FESCRIBEFICHERO(":HFICHERO")

  SELECT=SELECT 'CAB' TIPOREG, PEC.CODDIV,PEC.CODPED,PEC.ANOPED,PEC.SEQPED,PEC.PEDIDOHOST, PEC.CODALB, TO_CHAR(TO_DATE(VD.FECHASYS,'J'),'YYYYMMDD') FECTERMIN, PEC.HORATERMIN, 1 ESTADO,
                (SELECT COUNT(*) FROM VDBULTOCAB WHERE CODPED=PEC.CODPED AND ANOPED=PEC.ANOPED AND CODDIV=PEC.CODDIV AND SEQPED=PEC.SEQPED) BULTOS,
				(SELECT COUNT(*) FROM VDPEDIDOLIN WHERE CODPED=PEC.CODPED AND ANOPED=PEC.ANOPED AND CODDIV=PEC.CODDIV AND SEQPED=PEC.SEQPED) LINEAS,
                'S' SALDADO, PEC.CODCLIENTE, 
				IHO.ROWID IHOROWID 
          FROM VDPEDIDOCAB PEC,VDINTERPENDHOST IHO
          WHERE IHO.CLAVEINTER=PEC.CODPED AND IHO.STATUS=1000;
         
  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,OCULTO,"____"
  CAMPO=CODPED,OCULTO,"_20_____________________"
  CAMPO=ANOPED,OCULTO,"@L@@"
  CAMPO=SEQPED,OCULTO,"@L@"
  CAMPO=IHOROWID,AUXILIAR,OCULTO,"_40"
  CAMPO=NOMBREFICH,AUXILIAR,VIRTUAL,OCULTO
  
ENDBLOQUE

BEGINBLOQUEFRM=LINEAS
  PADRE=CABECERAS
  TABLA=EXPED LIN
  SOLOQUERY
  POSTQUERY=FEJECUTA(FESCRIBEFICHERO(":HFICHERO"),"No puedo escribir en fichero")

  SELECT=SELECT 'LIN' TIPOREG, PEL.CODDIV,PEL.CODPED, PEL.ANOPED, PEL.SEQPED,  PEL.PEDIDOHOST, PEC.CODALB, PEL.CODART, BUL.CODLOT, 
                PEL.CANTSERVIDA CANTIDAD,POL.SEQLINEA, PEL.UNIDADESHOST, PEL.PRECIOUNI, PEL.DCTO, 1 SALDADO 
         FROM VDPEDIDOLIN PEL, VDPEDIDOCAB PEC, VDPEDIDORIGLIN POL, VDBULTOCAB BUC, VDBULTOLIN BUL 
         WHERE PEL.CODDIV=:CODDIV AND PEL.ANOPED=:ANOPED AND PEL.CODPED=:CODPED AND PEL.SEQPED=:SEQPED AND 
            PEC.CODPED = PEL.CODPED AND PEC.CODDIV = PEL.CODDIV AND PEC.ANOPED = PEL.ANOPED AND PEC.SEQPED = PEL.SEQPED AND 
            POL.CODDIV=PEL.CODDIV AND POL.ANOPED=PEL.ANOPED AND POL.CODPED=PEL.CODPED AND POL.SEQLINEA=PEL.SEQLINORIG AND 
            BUC.CODPED = PEC.CODPED AND BUC.ANOPED = PEC.ANOPED AND BUC.CODDIV = PEC.CODDIV AND PEC.SEQPED = BUC.SEQPED AND  
			BUC.CODBULTO = BUL.CODBULTO AND BUL.CODART = PEL.CODART;
                 
  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=ANOPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=IHOROWID,AUXILIAR,VIRTUAL,OCULTO
  
ENDBLOQUE

BEGINBLOQUEFRM=BULTOCAB
  PADRE=LINEAS
  TABLA=EXPED BUC
  SOLOQUERY
  POSTQUERY=FEJECUTA(FESCRIBEFICHERO(":HFICHERO"),"No puedo escribir en fichero")

  SELECT=SELECT 'BUC' TIPOREG, BUC.CODDIV,BUC.CODPED, BUC.ANOPED, BUC.SEQPED, BUC.CODBULTO CODBULTO, BUC.MATCAJA, BUC.TRACKINGAGE TRACKING, TO_CHAR(TO_DATE(BUC.FECCREADO,'J'),'YYYYMMDD') FECPREPARA, BUC.NBULTO 
		 FROM VDBULTOCAB BUC 
         WHERE BUC.CODDIV=:CODDIV AND BUC.ANOPED=:ANOPED AND BUC.CODPED=:CODPED AND BUC.SEQPED=:SEQPED;
                 
  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=ANOPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=IHOROWID,AUXILIAR,VIRTUAL,OCULTO
  
ENDBLOQUE

BEGINBLOQUEFRM=BULTOLIN
  PADRE=BULTOCAB
  TABLA=EXPED BUL
  SOLOQUERY
  POSTQUERY=FEJECUTA(FESCRIBEFICHERO(":HFICHERO"),"No puedo escribir en fichero")
  POSTUPDATE=FEJECUTA("CUPDASTATUS","No puedo actualizar",FCOMMIT,"")

  SELECT=SELECT 'BUL' TIPOREG, BUC.CODDIV,BUC.CODPED, BUC.ANOPED, BUC.SEQPED,  BUL.CODBULTO, BUL.CODART, BUL.CODLOT, BUL.CANTSERVIDA, BUL.SEQLINEA, BUC.NBULTO 
		 FROM VDBULTOLIN BUL, VDBULTOCAB BUC 
         WHERE BUL.CODBULTO = BUC.CODBULTO AND BUC.CODDIV=:CODDIV AND BUC.ANOPED=:ANOPED AND BUC.CODPED=:CODPED AND BUC.SEQPED=:SEQPED;
                 
  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=ANOPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=IHOROWID,AUXILIAR,VIRTUAL,OCULTO
  
  CURSOR=CUPDASTATUS UPDATE VDINTERPENDHOST SET STATUS=2000,
                                            CODOPEMODIF=VDUSER.GETUSER,FECMODIF=VD.FECHASYS,HORAMODIF=VD.HORASYS
                       WHERE ROWID=:IHOROWID;
  
ENDBLOQUE