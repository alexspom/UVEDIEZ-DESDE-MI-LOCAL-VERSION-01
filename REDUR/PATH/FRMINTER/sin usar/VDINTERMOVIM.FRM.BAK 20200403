CAMPO=HFICHERO,AUXILIAR,OCULTO,"@L@@@@@@@@@@"
CAMPO=CODDIV,AUXILIAR,OCULTO,"____"
CAMPO=EXT,AUXILIAR,OCULTO,"_4"
CAMPO=NOMBREFICH,AUXILIAR,OCULTO,"_256_"

BEGINBLOQUEFRM=MOVIMDIV
   TABLA=DUAL
   SOLOQUERY

   SELECT=SELECT DISTINCT BUZONOUT BUZONOUT, '' FTPHOST,'' FTPUSUARIO, '' FTPCLAVE, /*NVL(FTPRUTA,'.')*/ '' FTPRUTA, :NOMBREFICH||TO_CHAR(SYSDATE,'DDMMYYYYHH24MISS')||'.txt' NOMBREFICH
           FROM VDDIVIS
           WHERE CODDIV = :CODDIV
		   AND EXISTS (SELECT 1
						 FROM VDARTIC AR, VDMOVIM MV, VDCONCEPTOMAP CM, VDCONCEPTO CO
						 WHERE MV.CODART = AR.CODART
						 AND MV.CODCONCE = CO.CODCONCE
						 AND CM.CODCONCE(+) = CO.CODCONCE
						 AND NVL(CM.RANCODDIV,AR.CODDIV) = AR.CODDIV
						 AND AR.CODDIV = :CODDIV
						 AND MV.STATUS = VDST.FMOVPDTEINTER);

   CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=BUZONOUT,AUXILIAR,OCULTO,"_256"
   CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=FTPHOST,AUXILIAR,OCULTO,"_50"
   CAMPO=FTPUSUARIO,AUXILIAR,OCULTO,"_50"
   CAMPO=FTPCLAVE,AUXILIAR,OCULTO,"_50"
   CAMPO=FTPRUTA,AUXILIAR,OCULTO,"_100"
   CAMPO=NOMBREFICH,AUXILIAR,VIRTUAL,OCULTO
   CAMPO=EXT,AUXILIAR,VIRTUAL,OCULTO
ENDBLOQUE

BEGINBLOQUEFRM=MOVIM
  PADRE=MOVIMDIV
  TABLA=MOVTOS STD
  SOLOQUERY

  PREBLOQUE=FABREFICHERONOMBRE(":BUZONOUT","HFICHERO",":NOMBREFICH")
                     

  POSTBLOQUE=FEJECUTA(FCIERRAFICHERO(":HFICHERO"),"",
                      FCOMMIT,"")


  POSTQUERY=FESCRIBEFICHERO(":HFICHERO")
    
  POSTUPDATE=FEJECUTA("CUPDAMOV","No puedo actualizar el movimiento")

  SELECT=SELECT AR.CODART, MV.CODLOT CODLOT, MV.CANTIDAD, AR.UNIDADESHOST, CO.TIPOCONCE DIRMOV, MV.CODMOV CODMOV,NVL(CM.CONCEPTOINTER,CO.CODCONCE) CONCEPTO, 
                AR.CODDIV, 'A' ESTADO, TO_CHAR(TO_DATE(FECFINMOV,'J'),'YYYYMMDD') FECFINMOV, HORAFINMOV
         FROM VDARTIC AR, VDMOVIM MV, VDCONCEPTOMAP CM, VDCONCEPTO CO
         WHERE MV.CODART = AR.CODART
         AND MV.CODCONCE = CO.CODCONCE
         AND CM.CODCONCE(+) = CO.CODCONCE
		 AND NVL(CM.RANCODDIV,AR.CODDIV) = AR.CODDIV
         AND AR.CODDIV = :CODDIV
         AND MV.STATUS = VDST.FMOVPDTEINTER
		 AND CO.TIPOCONCE IN ('E','S');
  
  CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODMOV,AUXILIAR,OCULTO,"@@@@@@@@@"
  CAMPO=NOMBREFICH,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=FTPHOST,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=FTPUSUARIO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=FTPCLAVE,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=FTPRUTA,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=PARAMSFTP,AUXILIAR,OCULTO,"_500"
  
  CURSOR=CUPDAMOV UPDATE VDMOVIM SET STATUS=VDST.FMOVINTERFASAD WHERE CODMOV=:CODMOV;
  
  CURSOR=CTIENEFTP SELECT :FTPHOST FTPHOST FROM DUAL WHERE :CODDIV IN ('LE','LV');

  CURSOR=CPARAMS SELECT :FTPHOST||' '||:FTPUSUARIO||' '||:FTPCLAVE||' '||:BUZONOUT||'\'||:NOMBREFICH||' '||:FTPRUTA||' S' PARAMSFTP FROM DUAL;

ENDBLOQUE
