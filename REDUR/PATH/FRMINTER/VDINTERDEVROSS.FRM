CAMPO=HFICHERO,AUXILIAR,OCULTO,"@L@@@@@@@@@@"
CAMPO=CODDIV,AUXILIAR,OCULTO,"____"

BEGINBLOQUEFRM=INTERDEVROSS
  TABLA=DUAL
  SOLOQUERY
  
  SELECT=SELECT DISTINCT BUZONOUT BUZONOUT
           FROM NOR.IPDIVIS
          WHERE CODDIV LIKE :CODDIV;
  
  CAMPO=BUZONOUT,AUXILIAR,OCULTO,"_256"
  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
ENDBLOQUE

BEGINBLOQUEFRM=HEADER
  PADRE=INTERDEVROSS
  TABLA=DEVROSS TEXTOCAB
  SOLOQUERY

  SELECT=SELECT '[HEADER]' CABECERA,SEQDEVOL FROM VDDEVOLCAB WHERE STATUS=VDST.FDVCESCANEADA;

  POSTQUERY=FEJECUTA(FABREFICHEROSTD(":BUZONOUT","HFICHERO"),"No puedo abrir fichero cabecera",
                     FESCRIBEFICHERO(":HFICHERO"),"Error escribiendo en fichero cabecera")
  

  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=BUZONOUT,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODDIV,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQDEVOL,AUXILIAR,OCULTO,"_20_"
ENDBLOQUE

BEGINBLOQUEFRM=CABECERAS
  PADRE=HEADER
  TABLA=DEVROSS DATOSCAB
  SOLOQUERY

  SELECT=SELECT SEQDEVOL,CODCLIENTE,'PDN' PORTAL,CODPED FROM VDDEVOLCAB WHERE SEQDEVOL=:SEQDEVOL AND STATUS=VDST.FDVCESCANEADA;

  POSTQUERY=FEJECUTA(FESCRIBEFICHEROINTER(":HFICHERO","DEVROSS","DATOSCAB"),"No puedo escribir en fichero")

  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQDEVOL,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODPED,AUXILIAR,OCULTO,"_20_"
ENDBLOQUE

BEGINBLOQUEFRM=LINES
  PADRE=CABECERAS
  TABLA=DEVROSS TEXTOLIN
  SOLOQUERY

  SELECT=SELECT '[LINES]' LINEAS FROM VDDEVOLCAB WHERE SEQDEVOL=:SEQDEVOL;

  POSTQUERY=FEJECUTA(FESCRIBEFICHEROINTER(":HFICHERO","DEVROSS","TEXTOLIN"),"No puedo escribir en fichero")

  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQDEVOL,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODPED,AUXILIAR,VIRTUAL,OCULTO
ENDBLOQUE

BEGINBLOQUEFRM=LINEAS
  PADRE=LINES
  TABLA=DEVROSS DATOSLIN
  SOLOQUERY

  POSTBLOQUE=FEJECUTA("CUPDADEVOL","No puede actualizarse cabecera de devolución",
                      FCIERRAFICHERO(":HFICHERO"),"No puedo cerrar ficheros",
                      FCOMMIT,"")
  
  SELECT=SELECT SUBSTR(ART.CODNAC,1,INSTR(ART.CODNAC,'.')-1) CODNAC,ART.CODART,CODLOT,'Y' RECALCULAPRECIO,SUM(CANTIDAD) CANTIDADLINEA  
           FROM VDDEVOLLIN DVL,NOR.IPARTIC ART 
          WHERE DVL.SEQDEVOL=:SEQDEVOL AND DVL.CODART=ART.CODART
		 GROUP BY ART.CODNAC,ART.CODART,CODLOT;

  POSTQUERY=FEJECUTA("+CSELPRECIO","",
                     FESCRIBEFICHEROINTER(":HFICHERO","DEVROSS","DATOSLIN"),"No puedo escribir en fichero")

  CURSOR=CSELPRECIO SELECT (PEL.PRECIOUNI-(PEL.PRECIOUNI*PEL.DCTO/100))*:CANTIDADLINEA PRECIONETO,'N' RECALCULAPRECIO 
                      FROM NOR.IPCABPE PEC,NOR.IPLINPE PEL 
                     WHERE PEC.CODPED=PEL.CODPED AND PEC.CODDIV=PEL.CODDIV AND 
                           PEC.ANOPED=PEL.ANOPED AND PEC.SEQPED=PEL.SEQPED AND
						   PEC.CODALB=:CODPED AND PEL.CODART=:CODART AND PEL.CODLOT=:CODLOT;
						   
  CURSOR=CUPDADEVOL UPDATE VDDEVOLCAB SET STATUS=VDST.FDVCPDTEPROTO
                     WHERE SEQDEVOL=:SEQDEVOL AND STATUS=VDST.FDVCESCANEADA;

  CAMPO=HFICHERO,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=SEQDEVOL,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODPED,AUXILIAR,VIRTUAL,OCULTO
  CAMPO=CODART,AUXILIAR,OCULTO,"_20_"
  CAMPO=CODLOT,AUXILIAR,OCULTO,"_20_"
#  CAMPO=CANTIDADLINEA,AUXILIAR,OCULTO,"@@@@@@@@@"
ENDBLOQUE
